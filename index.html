<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Langini Meteo ‚Äì Dashboard V7.0</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/raphael@2.3.0/raphael.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/justgage@1.5.0/justgage.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>

<style>
body{
  margin:0;font-family:"Poppins",sans-serif;color:white;text-align:center;
  overflow-x:hidden;transition:background 2s;
  background:linear-gradient(to bottom,#001b3a 0%,#004a8d 40%,#0066b2 100%);
}
header{
  background:rgba(0,0,30,0.7);color:#fff;padding:16px 0 4px;
  font-size:1.7em;font-weight:600;box-shadow:0 2px 10px rgba(0,0,0,0.25);
}
#logo{font-size:1.05em;font-weight:400;color:#a9c9ff;}
#statusBar{background:rgba(0,0,0,0.15);font-size:0.93em;color:#a9c9ff;padding:6px;}
#sky{position:relative;height:46vh;overflow:hidden;border-bottom:4px solid #048;}
#stars{position:absolute;inset:0;opacity:0;z-index:1;}
.star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:twinkle 4s infinite;}
@keyframes twinkle{0%,100%{opacity:0.2}50%{opacity:1}}

#sun,#moon{
  position:absolute;top:53%;left:50%;width:110px;height:110px;border-radius:50%;
  transform:translate(-50%,-50%);transition:left 1.5s,top 1.5s,opacity 2s;
  z-index:2;opacity:0;
}
#sun{background:radial-gradient(circle,#fff600 20%,#ffcc00 70%,#ffaa00 100%);
  box-shadow:0 0 40px 10px #ffcc00;}
#moon{background:radial-gradient(circle at 31% 32%,#f0f0f0 40%,#bdbdbd 100%);
  box-shadow:0 0 25px 5px #ccc;}

/* ‚òÅÔ∏è Nuvole */
.cloud{
  position:absolute;background:rgba(255,255,255,0.9);
  border-radius:50%;
  box-shadow:-40px 10px 60px rgba(255,255,255,0.6),
              60px 20px 80px rgba(255,255,255,0.5),
              120px 30px 100px rgba(255,255,255,0.4);
  animation:fluttuare 6s ease-in-out infinite alternate;
  z-index:2;
}
@keyframes fluttuare{from{transform:translateY(0)}to{transform:translateY(8px)}}

/* ‚úàÔ∏è Aereo + scia */
#plane{
  position:absolute;top:25%;left:-150px;width:120px;height:40px;
  background:url('https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Airplane_silhouette.svg/128px-Airplane_silhouette.svg.png') no-repeat center/contain;
  z-index:3;opacity:0.9;filter:drop-shadow(0 0 6px rgba(255,255,255,0.7));
}
.trail{
  position:absolute;height:4px;background:linear-gradient(90deg,rgba(255,255,255,0.7),rgba(255,255,255,0));
  border-radius:2px;z-index:2;opacity:0.6;
  pointer-events:none;
}

/* üê¶ Uccelli */
.bird{
  position:absolute;width:32px;height:24px;
  background:url('https://upload.wikimedia.org/wikipedia/commons/6/6b/Bird_silhouette.svg') no-repeat center/contain;
  opacity:0.85;z-index:3;animation:birdFlap 1.2s infinite;
}
@keyframes birdFlap{0%,100%{transform:translateY(0) scale(1);}50%{transform:translateY(-4px) scale(1.05);}}

/* üå´Ô∏è Banner AQI */
#ariaAlert{
  display:block;margin:18px auto 10px auto;padding:10px 32px;
  border-radius:22px;font-size:1.35em;font-weight:700;color:#fff;
  background:#00e400;box-shadow:0 0 25px rgba(0,255,0,0.5);
  width:fit-content;transition:all 0.8s ease;animation:none;z-index:5;text-align:center;
}
@keyframes blinkAir{from{opacity:0.6;}to{opacity:1;}}
@keyframes pulseDanger{0%,100%{box-shadow:0 0 25px 8px rgba(102,0,153,0.8);}50%{box-shadow:0 0 40px 16px rgba(255,0,255,0.7);}}

/* ‚òÄÔ∏è Barra Alba/Tramonto */
#sunMoonTimes{
  display:block;margin:0 auto 14px auto;font-size:1em;color:#000;
  background:rgba(255,255,255,0.65);padding:5px 14px;border-radius:12px;
  box-shadow:0 0 6px rgba(0,0,0,0.25);font-weight:600;width:fit-content;text-align:center;
}

/* üß≠ Gauge Section */
#gauges{
  display:flex;flex-wrap:wrap;justify-content:center;gap:22px;
  padding:20px 0 30px;background:linear-gradient(to bottom,#002850,#00142c);
  border-top:3px solid #004b8d;
}
.gaugeBox{
  background:linear-gradient(to bottom,#f8fbff,#e6edf5);
  border-radius:16px;width:230px;height:235px;padding:8px;
  color:#003366;box-shadow:0 0 10px rgba(0,0,0,0.14);position:relative;
}
.gaugeBox img{position:absolute;top:8px;right:8px;width:34px;opacity:0.84;}
.label{font-size:1.05em;font-weight:600;margin-top:6px;}
.mean{font-size:0.88em;color:#444;margin-top:6px;}
footer{font-size:0.9em;color:#a9c9ff;background:#001b3a;padding:10px;}

/* üì± Mobile */
@media (max-width:768px){
  #gauges{gap:18px;}
  .gaugeBox{width:45%;height:220px;padding:6px;}
  .label{font-size:0.95em;}
  .mean{font-size:0.82em;}
}
@media (max-width:480px){
  #gauges{flex-direction:column;align-items:center;}
  .gaugeBox{width:85%;height:210px;}
  #ariaAlert{font-size:1.1em;padding:8px 20px;}
  #sunMoonTimes{font-size:0.95em;padding:4px 10px;}
  header{font-size:1.3em;}
}
</style>
</head>

<body>
<header>üå§Ô∏è Langini Meteo ‚Äì Dashboard V7.0<br><div id="logo">by Langini D.</div></header>
<div id="statusBar">Caricamento dati...</div>

<div id="sky">
  <div id="stars"></div>
  <div id="sun"></div>
  <div id="moon"></div>
  <div id="plane"></div>
</div>

<!-- üå´Ô∏è Banner -->
<div id="ariaAlert">üåø Aria eccellente</div>
<!-- ‚òÄÔ∏è Alba/Tramonto -->
<div id="sunMoonTimes">‚òÄÔ∏è Alba: --:-- ‚Ä¢ üåá Tramonto: --:--</div>

<!-- üß≠ Gauges -->
<div id="gauges">
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/barometer.png"><div id="g1" style="height:130px"></div><div class="label">Pressione (hPa)</div><div class="mean">Media oraria: <span id="m1">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/temperature.png"><div id="g2" style="height:130px"></div><div class="label">Temperatura (¬∞C)</div><div class="mean">Media oraria: <span id="m2">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/hygrometer.png"><div id="g3" style="height:130px"></div><div class="label">Umidit√† (%)</div><div class="mean">Media oraria: <span id="m3">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/smelling.png"><div id="g4" style="height:130px"></div><div class="label">Qualit√† Aria (MQ135)</div><div class="mean">Media oraria: <span id="m4">--</span></div></div>
</div>

<footer>¬© 2025 Langini Meteo ‚Ä¢ Aggiornamento ogni 30 s</footer>

<script>
const LAT=45.77,LON=8.88,CHANNEL_ID=3149218;
const g1=new JustGage({id:"g1",value:0,min:950,max:1050,pointer:true});
const g2=new JustGage({id:"g2",value:0,min:-10,max:50,pointer:true});
const g3=new JustGage({id:"g3",value:0,min:0,max:100,pointer:true});
const g4=new JustGage({id:"g4",value:0,min:0,max:500,pointer:true});

// === ANIMAZIONE CIELO COMPLETA ===
function creaNuvola(){const sky=document.getElementById("sky");const c=document.createElement("div");c.className="cloud";const s=0.8+Math.random()*1.4;c.style.width=(80+Math.random()*160)*s+"px";c.style.height=(35+Math.random()*45)*s+"px";c.style.top=(10+Math.random()*60)+"%";c.style.left="-250px";c.style.opacity=0.4+Math.random()*0.4;sky.appendChild(c);const dur=30000+Math.random()*40000;c.animate([{transform:"translateX(0)"},{transform:`translateX(${window.innerWidth+400}px)`}],{duration:dur,easing:"linear"}).onfinish=()=>{c.remove();setTimeout(creaNuvola,4000+Math.random()*3000);};}
function volaAereo(){const p=document.getElementById('plane');const t=20+Math.random()*40;p.style.top=t+'%';p.style.left='-150px';p.style.transition='none';p.offsetHeight;p.style.transition='left 25s linear';p.style.left='110%';// SCIA
const trail=document.createElement('div');trail.className='trail';trail.style.top=`calc(${t}% + 20px)`;trail.style.left='-150px';trail.style.width='0px';document.getElementById("sky").appendChild(trail);
trail.animate([{width:'0px',opacity:0.8},{width:window.innerWidth+'px',opacity:0.1}],{duration:25000,easing:'linear'}).onfinish=()=>trail.remove();
setTimeout(volaAereo,35000+Math.random()*40000);}
function creaUccello(){const sky=document.getElementById("sky");const b=document.createElement("div");b.className="bird";b.style.top=(20+Math.random()*50)+"%";b.style.left="-60px";b.style.transform=`scale(${0.7+Math.random()*0.6})`;sky.appendChild(b);const dur=15000+Math.random()*12000;b.animate([{transform:"translateX(0)"},{transform:`translateX(${window.innerWidth+200}px)`}],{duration:dur,easing:"linear"}).onfinish=()=>{b.remove();setTimeout(creaUccello,4000+Math.random()*7000);};}
function aggiornaCielo(){const now=new Date(),t=SunCalc.getTimes(now,LAT,LON);const alba=t.sunrise.getHours()*60+t.sunrise.getMinutes();const tram=t.sunset.getHours()*60+t.sunset.getMinutes();const curr=now.getHours()*60+now.getMinutes();const sun=document.getElementById("sun"),moon=document.getElementById("moon"),stars=document.getElementById("stars");document.getElementById("sunMoonTimes").innerHTML=`‚òÄÔ∏è Alba: ${String(t.sunrise.getHours()).padStart(2,"0")}:${String(t.sunrise.getMinutes()).padStart(2,"0")} ‚Ä¢ üåá Tramonto: ${String(t.sunset.getHours()).padStart(2,"0")}:${String(t.sunset.getMinutes()).padStart(2,"0")}`;if(curr>=alba&&curr<tram){stars.style.opacity=0;sun.style.opacity=1;moon.style.opacity=0;const p=(curr-alba)/(tram-alba);sun.style.left=5+p*90+"%";sun.style.top=53-17*Math.sin(p*Math.PI)+"%";}else{stars.style.opacity=0.9;moon.style.opacity=1;sun.style.opacity=0;const tot=(24*60-tram)+alba;const pass=curr>=tram?(curr-tram):(curr+24*60-tram);const p=pass/tot;moon.style.left=95-p*90+"%";moon.style.top=53-12*Math.sin(p*Math.PI)+"%";}}
function initCielo(){for(let i=0;i<40;i++){let e=document.createElement('div');e.className='star';e.style.left=Math.random()*100+'%';e.style.top=Math.random()*100+'%';e.style.animationDelay=Math.random()*3+'s';document.getElementById('stars').appendChild(e);}for(let i=0;i<5;i++)setTimeout(creaNuvola,Math.random()*6000);for(let i=0;i<3;i++)setTimeout(creaUccello,Math.random()*8000);volaAereo();aggiornaCielo();setInterval(aggiornaCielo,60000);}
document.addEventListener("DOMContentLoaded",initCielo);

// === DATI ===
async function aggiorna(){try{const r=await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=60`);const d=await r.json();if(!d.feeds||!d.feeds.length)return;const f=d.feeds.map(e=>({f1:+e.field1,f2:+e.field2,f3:+e.field3,f4:+e.field4})),u=f.at(-1);g1.refresh(u.f1);g2.refresh(u.f2);g3.refresh(u.f3);g4.refresh(u.f4);const avg=a=>{const v=a.filter(x=>!isNaN(x));return v.length?(v.reduce((a,b)=>a+b,0)/v.length).toFixed(1):"--";};["m1","m2","m3","m4"].forEach((id,i)=>document.getElementById(id).textContent=avg(f.map(x=>x[`f${i+1}`])));const aqi=u.f4,alert=document.getElementById("ariaAlert");let text="--",bg="#00e400",anim="none";if(aqi<=50){text="üåø Aria eccellente";bg="#00e400";}else if(aqi<=100){text="üòä Aria buona";bg="#9cff00";}else if(aqi<=150){text="‚ö†Ô∏è Qualit√† moderata";bg="#ffde33";anim="blinkAir 1.4s infinite alternate";}else if(aqi<=200){text="üò∑ Aria scadente";bg="#ff9933";}else if(aqi<=300){text="‚ò†Ô∏è Aria molto scarsa";bg="#cc0033";}else{text="üíÄ Aria pericolosa";bg="#660099";anim="pulseDanger 2.5s infinite alternate";}alert.textContent=text;alert.style.background=bg;alert.style.boxShadow=`0 0 25px ${bg}`;alert.style.animation=anim;document.getElementById("statusBar").textContent=`‚úÖ Aggiornato alle ${new Date().toLocaleTimeString("it-IT")}`;}catch(e){document.getElementById("statusBar").textContent="‚ö†Ô∏è Errore connessione";console.error(e);}}
aggiorna();setInterval(aggiorna,30000);
</script>
</body>
</html>
