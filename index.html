<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Langini Meteo ‚Äì Dashboard</title>

<!-- SunCalc -->
<script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>

<style>
/* =====================================================
   STILE GENERALE
===================================================== */
body {
    margin: 0;
    background: #000814;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto;
    color: white;
    overflow-x: hidden;
}

/* =====================================================
   OVERLAY PASSWORD
===================================================== */
#lockScreen {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.lockBox {
  background: #0b1120;
  padding: 20px;
  border-radius: 14px;
  width: 300px;
  text-align: center;
  border: 1px solid #344155;
}

.lockBox input {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border-radius: 8px;
  border: 1px solid #444;
  background: #020617;
  color: #fff;
}

.lockBox button {
  width: 100%;
  margin-top: 12px;
  padding: 12px;
  background: #ff8c00;
  border: none;
  border-radius: 8px;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}

/* =====================================================
   CIELO + STELLE + SOLE/LUNA
===================================================== */
#sky {
  position: fixed;
  inset: 0;
  background: #001027;
  overflow: hidden;
  z-index: -1;
}

/* Stelle */
#stars {
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:0;
  transition: opacity 1.2s;
}

.star {
  position:absolute;
  width:2px;
  height:2px;
  background:white;
  border-radius:50%;
  animation: twinkle 4s infinite;
}

@keyframes twinkle {
  0% {opacity:0;}
  50% {opacity:1;}
  100% {opacity:0;}
}

/* Sole & Luna */
#sunMoon {
  position:absolute;
  width:100px;
  height:100px;
  border-radius:50%;
  pointer-events:none;
  transition:left 1s linear, top 1s linear;
}

.sun {
  background: radial-gradient(circle, #fff5aa, #ffcc33, #ff9900);
  box-shadow: 0 0 32px 18px rgba(255,180,0,0.65);
}

.moon {
  background: radial-gradient(circle, #ffffff, #bfc4ce);
  box-shadow: 0 0 28px 14px rgba(180,180,255,0.35);
}

/* =====================================================
   CONTENUTO PRINCIPALE
===================================================== */
.content {
  max-width: 1100px;
  margin-top: 1vh;
  padding: 20px;
  text-align: center;
  margin-left: auto;
  margin-right: auto;
}

h1.title {
  font-size: 1.8rem;
  margin-bottom: 10px;
}

#sunTimes {
  font-size: 1.1rem;
  margin-bottom: 22px;
}

/* Pulsante vento/pioggia */
.windButton {
  display:block;
  margin:0 auto 70px auto;
  padding:14px 22px;
  background:linear-gradient(135deg,#00aaff,#0077cc);
  color:white;
  font-size:1.1rem;
  border-radius:12px;
  text-decoration:none;
  box-shadow:0 0 14px rgba(0,150,255,0.7);
  width:95%;
  max-width:330px;
  font-weight:700;
}

/* =====================================================
   CARD METEO
===================================================== */
.cards {
  margin-top: 57vh;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:18px;
  max-width:1100px;
  margin-left: auto;
  margin-right: auto;
}

.card {
  background:white;
  color:black;
  padding:14px;
  border-radius:12px;
  box-shadow:0 0 18px rgba(0,0,0,0.35);
}

.value {
  font-size:1.7rem;
  font-weight:bold;
}

.gauge {
  width:100%;
  height:10px;
  background:#e6e6e6;
  border-radius:10px;
  margin-top:8px;
}

.gauge-fill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ffb300,#ff6d00);
  border-radius:10px;
  transition:width .3s;
}

</style>
</head>

<body>

<!-- PASSWORD -->
<div id="lockScreen">
  <div class="lockBox">
    <h2>Accesso</h2>
    <input type="password" id="pwd" placeholder="Password">
    <button onclick="unlock()">Entra</button>
    <p id="err" style="color:#f55; margin-top:8px;"></p>
  </div>
</div>

<!-- SFONDO -->
<div id="sky">
  <div id="stars"></div>
  <div id="sunMoon"></div>
</div>

<!-- CONTENUTO -->
<div class="content">

  <h1 class="title">üåü Langini Meteo ‚Äì Dashboard</h1>

  <div id="sunTimes">Alba: --:-- ‚Ä¢ Tramonto: --:--</div>

  <a href="https://972davide.github.io/Langini_Meteo_Wind.html/"
     class="windButton">üå¨Ô∏è Apri Dashboard Vento / Pioggia</a>

  <div class="cards">

    <div class="card">
      <div>Pressione</div>
      <div class="value" id="pressureValue">--</div>
      <div class="gauge"><div class="gauge-fill" id="gaugePressure"></div></div>
    </div>

    <div class="card">
      <div>Temperatura</div>
      <div class="value" id="tempValue">--</div>
      <div class="gauge"><div class="gauge-fill" id="gaugeTemp"></div></div>
    </div>

    <div class="card">
      <div>Umidit√†</div>
      <div class="value" id="humValue">--</div>
      <div class="gauge"><div class="gauge-fill" id="gaugeHum"></div></div>
    </div>

    <div class="card">
      <div>Qualit√† Aria</div>
      <div class="value" id="aqValue">--</div>
      <div class="gauge"><div class="gauge-fill" id="gaugeAQ"></div></div>
    </div>

  </div>
</div>

<!-- SCRIPT ================================================================= -->

<script>
let unlocked = false;
const PASSWORD = "Doroty025";

function unlock() {
  const pw = document.getElementById("pwd").value.trim();
  if (pw === PASSWORD) {
    unlocked = true;
    document.getElementById("lockScreen").style.display = "none";
    toggleStars();
  } else {
    document.getElementById("err").textContent = "Password errata.";
  }
}

/* ============================================================
   STELLE
============================================================ */
function initStars() {
  const container = document.getElementById("stars");
  for (let i = 0; i < 90; i++) {
    const s = document.createElement("div");
    s.className = "star";
    s.style.top = Math.random() * 100 + "%";
    s.style.left = Math.random() * 100 + "%";
    s.style.animationDelay = Math.random() * 3 + "s";
    container.appendChild(s);
  }
}
initStars();

function toggleStars() {
    const stars = document.getElementById("stars");
    stars.style.opacity = isNightTime() ? 1 : 0;
}

function isNightTime() {
    const now = new Date();
    const t = SunCalc.getTimes(now, 45.7525, 8.8975);
    return now < t.sunrise || now > t.sunset;
}

/* ============================================================
   ORBITA SOLE/LUNA ‚Äì CURVA C (ALTA)
============================================================ */
function updateSky() {
    if (!unlocked) return;

    const now = new Date();
    const LAT = 45.7525, LON = 8.8975;
    const times = SunCalc.getTimes(now, LAT, LON);

    let p = 0;
    const isDay = now >= times.sunrise && now <= times.sunset;

    if (isDay) {
        p = (now - times.sunrise) / (times.sunset - times.sunrise);
    } else {
        let nextSunrise = new Date(times.sunrise);
        if (now > times.sunset) nextSunrise.setDate(nextSunrise.getDate() + 1);
        p = (now - times.sunset) / (nextSunrise - times.sunset);
    }

    p = Math.max(0, Math.min(1, p));

    const W = window.innerWidth;
    const H = window.innerHeight;

    const centerY = H * 0.32;   /* pi√π alta */
    const radiusY = H * 0.36;   /* curva pi√π grande */

    const x = p * (W + 200) - 100;
    const y = centerY - Math.sin(p * Math.PI) * radiusY;

    const SM = document.getElementById("sunMoon");
    SM.style.left = `${x}px`;
    SM.style.top  = `${y}px`;
    SM.className = isDay ? "sun" : "moon";

    toggleStars();
}

/* ============================================================
   INFO SOLE (ALBA/TRAMONTO)
============================================================ */
function updateSunTimes() {
    const now = new Date();
    const t = SunCalc.getTimes(now, 45.7525, 8.8975);
    const fmt = d => d.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});
    document.getElementById("sunTimes").textContent =
        `Alba: ${fmt(t.sunrise)} ‚Ä¢ Tramonto: ${fmt(t.sunset)}`;
}

/* ============================================================
   DASHBOARD (DATI)
============================================================ */
async function updateDashboard() {
    if (!unlocked) return;
    try {
        const r = await fetch("https://api.thingspeak.com/channels/3149218/feeds.json?results=1");
        const d = await r.json();
        const m = d.feeds[0];

        const P = parseFloat(m.field1);
        const T = parseFloat(m.field2);
        const H = parseFloat(m.field3);
        const A = parseFloat(m.field4);

        pressureValue.textContent = P ? P.toFixed(0) : "--";
        tempValue.textContent     = T ? T.toFixed(1) : "--";
        humValue.textContent      = H ? H.toFixed(0) : "--";
        aqValue.textContent       = A ? A.toFixed(0) : "--";

        gaugePressure.style.width = Math.min(100, Math.max(0, P - 950)) + "%";
        gaugeTemp.style.width     = Math.min(100, Math.max(0, (T + 10) * 2)) + "%";
        gaugeHum.style.width      = Math.min(100, Math.max(0, H)) + "%";
        gaugeAQ.style.width       = Math.min(100, Math.max(0, (A / 500) * 100)) + "%";

    } catch(e){}
}

/* ============================================================
   LOOP PRINCIPALE
============================================================ */
setInterval(() => {
    if (!unlocked) return;
    updateSky();
    updateSunTimes();
    updateDashboard();
}, 3000);

</script>

</body>
</html>
