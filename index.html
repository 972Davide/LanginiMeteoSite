<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Langini Meteo ‚Äì Dashboard</title>
<script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>

<style>
/* =====================================================
   STILE BASE
===================================================== */
:root {
  --text: #fff;
  --bg: #000814;
  --card-bg: #ffffff;
  --card-text: #000;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: system-ui, -apple-system, "Segoe UI", Roboto;
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
}

/* =====================================================
   PASSWORD OVERLAY
===================================================== */
#lockScreen {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.lockBox {
  background:#0b1120;
  padding:20px;
  border-radius:14px;
  width:300px;
  text-align:center;
  border:1px solid #344155;
}

.lockBox input {
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #444;
  background:#020617;
  color:#fff;
}

.lockBox button {
  width:100%;
  margin-top:10px;
  padding:10px;
  border-radius:8px;
  border:none;
  background:#ff8c00;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

/* =====================================================
   CIELO SFONDO
===================================================== */
#sky {
  position:fixed;
  inset:0;
  background:#001027;
  transition:background 1s linear;
  overflow:hidden;
  z-index:-1;
}

/* =====================================================
   STELLE
===================================================== */
#stars {
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:0;
  transition:opacity 1.2s ease;
}

.star {
  position:absolute;
  width:2px;
  height:2px;
  background:white;
  border-radius:50%;
  animation:twinkle 3s infinite;
}

@keyframes twinkle {
  0%{opacity:0;}
  50%{opacity:1;}
  100%{opacity:0;}
}

/* =====================================================
   METEORE
===================================================== */
.meteor {
  position:absolute;
  width:140px;
  height:3px;
  background:linear-gradient(90deg, white, transparent);
  opacity:0;
  transform:rotate(30deg);
  pointer-events:none;
}

@keyframes meteorMove {
  0% {opacity:0; transform:translate(0,0) rotate(30deg);}
  10%{opacity:1;}
  100%{
    opacity:0;
    transform:translate(var(--mx), var(--my)) rotate(30deg);
  }
}

/* =====================================================
   SOLE / LUNA (ORBITA CENTRALE)
===================================================== */
#sunMoon {
  position:absolute;
  width:80px;
  height:80px;
  border-radius:50%;
  pointer-events:none;
  transition:left 1s linear, top 1s linear;
}

.sun {
  background:radial-gradient(circle, #fff5aa, #ffcc33, #ff9900);
  box-shadow:0 0 25px 12px rgba(255,180,0,0.7);
}

.moon {
  background:radial-gradient(circle, #ffffff, #bfc4ce);
  box-shadow:0 0 18px 8px rgba(180,180,255,0.4);
}

/* =====================================================
   CONTENUTO
===================================================== */
.content {
  max-width:1100px;
  margin: 18vh auto 0 auto;
  padding:20px;
  text-align:center;
}

h1.title {
  font-size:1.8rem;
  margin-bottom:20px;
}

#sunTimes {
  font-size:1.1rem;
  margin-bottom:25px;
}

/* =====================================================
   PULSANTE VENTO / PIOGGIA
===================================================== */
.windButton {
  display:block;
  margin:0 auto 30px auto;
  padding:12px 22px;
  background:linear-gradient(135deg,#00aaff,#0077cc);
  color:white;
  font-size:1.1rem;
  font-weight:700;
  text-align:center;
  border-radius:12px;
  text-decoration:none;
  box-shadow:0 0 14px rgba(0,150,255,0.7);
  width:95%;
  max-width:330px;
  border:1px solid rgba(0,180,255,0.5);
  transition:0.25s;
}
.windButton:hover { filter:brightness(1.15); }

/* =====================================================
   CARD DATI
===================================================== */
.cards {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:18px;
}

.card {
  background:#fff;
  color:#000;
  padding:14px;
  border-radius:12px;
  box-shadow:0 0 18px rgba(0,0,0,0.35);
}

.value {
  font-size:1.7rem;
  font-weight:bold;
}

.gauge {
  width:100%;
  height:10px;
  background:#e6e6e6;
  border-radius:10px;
  margin-top:8px;
}

.gauge-fill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg, #ffb300, #ff6d00);
  border-radius:10px;
  transition:width .3s;
}
</style>
</head>

<body>

<!-- ============================ PASSWORD ============================ -->
<div id="lockScreen">
  <div class="lockBox">
    <h2>Accesso</h2>
    <input type="password" id="pwd" placeholder="Password">
    <button onclick="unlock()">Entra</button>
    <p id="err" style="color:#f55; margin-top:8px;"></p>
  </div>
</div>

<!-- ============================ SOLE / LUNA ============================ -->
<div id="sky">
  <div id="stars"></div>
  <div id="meteor1" class="meteor"></div>
  <div id="meteor2" class="meteor"></div>
  <div id="sunMoon"></div>
</div>

<!-- ============================ CONTENUTO ============================ -->
<div class="content">
  <h1 class="title">üåü Langini Meteo ‚Äì Dashboard</h1>

  <div id="sunTimes">
    Alba: --:-- ‚Ä¢ Tramonto: --:--
  </div>

  <!-- üîµ Pulsante aggiunto -->
  <a href="https://972davide.github.io/Langini_Meteo_Wind.html/"
     class="windButton">
     üå¨Ô∏è Apri Dashboard Vento / Pioggia
  </a>

  <div class="cards">

    <div class="card">
      <div>Pressione</div>
      <div class="value" id="pressureValue">--</div>
      <div class="gauge"><div class="gauge-fill" id="gaugePressure"></div></div>
    </div>

    <div class="card">
      <div>Temperatura</div>
      <div class="value" id="tempValue">--</div>
      <div class="gauge"><div class="gauge-fill" id="gaugeTemp"></div></div>
    </div>

    <div class="card">
      <div>Umidit√†</div>
      <div class="value" id="humValue">--</div>
      <div class="gauge"><div class="gauge-fill" id="gaugeHum"></div></div>
    </div>

    <div class="card">
      <div>Qualit√† Aria</div>
      <div class="value" id="aqValue">--</div>
      <div class="gauge"><div class="gauge-fill" id="gaugeAQ"></div></div>
    </div>

  </div>
</div>

<!-- ============================ SCRIPT ============================ -->
<script>
/* =================== LOGIN =================== */
const PASSWORD = "Doroty025";
let unlocked = false;

function unlock(){
  const pw = document.getElementById("pwd").value.trim();
  if(pw === PASSWORD){
    unlocked = true;
    document.getElementById("lockScreen").style.display="none";
  } else {
    document.getElementById("err").textContent="Password errata.";
  }
}

/* =============================================================
   GENERA STELLE
============================================================= */
function initStars(){
  const c = document.getElementById("stars");
  for(let i=0;i<90;i++){
    const s=document.createElement("div");
    s.className="star";
    s.style.top=Math.random()*100+"%";
    s.style.left=Math.random()*100+"%";
    s.style.animationDelay=Math.random()*3+"s";
    c.appendChild(s);
  }
}
initStars();

/* =============================================================
   METEORE
============================================================= */
function triggerMeteor(id){
  if(!unlocked) return;

  const el=document.getElementById(id);
  const startX=-150-Math.random()*200;
  const startY=Math.random()*40+5;
  const dx=600+Math.random()*400;
  const dy=200+Math.random()*200;

  el.style.left=startX+"px";
  el.style.top=startY+"vh";

  el.style.setProperty("--mx",dx+"px");
  el.style.setProperty("--my",dy+"px");

  el.style.animation="none";
  void el.offsetWidth;
  el.style.animation="meteorMove 1.4s linear";

  setTimeout(()=>el.style.opacity=0,1500);
}

function scheduleMeteors(){
  setTimeout(()=>{
    if(unlocked){
      triggerMeteor("meteor1");
      if(Math.random() < 0.4) triggerMeteor("meteor2");
    }
    scheduleMeteors();
  }, 4000 + Math.random()*5000);
}
scheduleMeteors();

/* =============================================================
   SOLE / LUNA ORBITA ULTRA PRECISA
============================================================= */
function updateSky(){
  if(!unlocked) return;

  const now=new Date();
  const times=SunCalc.getTimes(now,45.7525,8.8975);
  const pos=SunCalc.getPosition(now,45.7525,8.8975);
  const alt=pos.altitude*180/Math.PI;

  const SM=document.getElementById("sunMoon");
  const isDay = now>=times.sunrise && now<=times.sunset;

  /* Tipo di corpo celeste */
  SM.className = isDay ? "sun" : "moon";

  /* Calcolo orbita precisa */
  const W = window.innerWidth;
  const H = window.innerHeight;

  const titoloY = H * 0.20;
  const cardsY  = H * 0.55;

  const zenithY = (titoloY + cardsY) / 2;
  const horizonY = cardsY + 40;

  const start = isDay ? times.sunrise : times.sunset;
  const end   = isDay ? times.sunset : new Date(times.sunrise.getTime()+86400000);

  let p = (now - start)/(end - start);
  p = Math.min(1,Math.max(0,p));

  const y = horizonY - Math.sin(p*Math.PI)*(horizonY - zenithY);
  const x = p*(W+200)-100;

  SM.style.left=x+"px";
  SM.style.top =y+"px";

  /* Colore cielo */
  const NIGHT="#000814", DAY="#1f2b3a";
  let blend = (alt + 12) / (45 + 12);
  blend = Math.min(1,Math.max(0,blend));
  document.getElementById("sky").style.background =
    interpolate(NIGHT,DAY,blend);
}

function interpolate(c1,c2,t){
  const a=parseInt(c1.slice(1),16);
  const b=parseInt(c2.slice(1),16);
  const r=((a>>16)&255)+(((b>>16)&255)-((a>>16)&255))*t;
  const g=((a>>8)&255)+(((b>>8)&255)-((a>>8)&255))*t;
  const bl=(a&255)+((b&255)-(a&255))*t;
  return `rgb(${r},${g},${bl})`;
}

/* =============================================================
   ALBA / TRAMONTO
============================================================= */
function updateSunTimes(){
  const now=new Date();
  const t=SunCalc.getTimes(now,45.7525,8.8975);

  const f=d=>d.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});

  document.getElementById("sunTimes").textContent=
    "Alba: "+f(t.sunrise)+" ‚Ä¢ Tramonto: "+f(t.sunset);
}

/* =============================================================
   DASHBOARD DATI
============================================================= */
async function updateDashboard(){
  if(!unlocked) return;

  try{
    const res = await fetch("https://api.thingspeak.com/channels/3149218/feeds.json?results=1");
    const data = await res.json();
    const m = data.feeds[0];

    const pressure=parseFloat(m.field1);
    const temp=parseFloat(m.field2);
    const hum=parseFloat(m.field3);
    const aqi=parseFloat(m.field4);

    document.getElementById("pressureValue").textContent =
      pressure ? pressure.toFixed(0) : "--";
    document.getElementById("tempValue").textContent =
      temp ? temp.toFixed(1) : "--";
    document.getElementById("humValue").textContent =
      hum ? hum.toFixed(0) : "--";
    document.getElementById("aqValue").textContent =
      aqi ? aqi.toFixed(0) : "--";

    document.getElementById("gaugePressure").style.width =
      Math.min(100,Math.max(0,(pressure-950)))+"%";
    document.getElementById("gaugeTemp").style.width =
      Math.min(100,Math.max(0,(temp+10)*2))+"%";
    document.getElementById("gaugeHum").style.width =
      Math.min(100,Math.max(0,hum))+"%";
    document.getElementById("gaugeAQ").style.width =
      Math.min(100,Math.max(0,(aqi/500)*100))+"%";

  }catch(e){
    console.log("Errore lettura dati",e);
  }
}

/* =============================================================
   LOOP PRINCIPALE
============================================================= */
setInterval(()=>{
  if(unlocked){
    updateSky();
    updateSunTimes();
    updateDashboard();
  }
}, 8000);
</script>

</body>
</html>
