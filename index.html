<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Langini Meteo Online</title>

<!-- Librerie per gauge -->
<script src="https://cdn.jsdelivr.net/npm/raphael@2.3.0/raphael.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/justgage@1.5.0/justgage.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(to bottom, #001028, #004070);
  color: white;
  text-align: center;
  overflow-x: hidden;
  min-height: 100vh;
}
header {
  background: rgba(153,152,168,0.9);
  color: white;
  font-weight: bold;
  padding: 12px 0;
  font-size: 1.6em;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

/* cielo dinamico */
#sky {
  position: relative;
  height: 45vh;
  overflow: hidden;
  transition: background 2s;
}
#stars {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background: transparent;
  overflow: hidden;
}
.star {
  position: absolute;
  width: 2px;
  height: 2px;
  background: white;
  border-radius: 50%;
  opacity: 0;
  animation: twinkle 4s infinite;
}
@keyframes twinkle {
  0%, 100% { opacity: 0; }
  50% { opacity: 1; }
}
#sun, #moon {
  position: absolute;
  top: 25%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 130px;
  height: 130px;
  border-radius: 50%;
  animation: float 6s ease-in-out infinite;
}
#sun {
  background: radial-gradient(circle, #fff600 10%, #ffcc00 60%, #ff8800 100%);
  box-shadow: 0 0 50px 15px #ffdd55;
}
#moon {
  background: radial-gradient(circle at 30% 30%, #f0f0f0 40%, #bdbdbd 100%);
  box-shadow: 0 0 35px 8px rgba(255,255,255,0.4);
}
@keyframes float {
  0% { transform: translate(-50%, -50%) scale(1); }
  50% { transform: translate(-50%, -60%) scale(1.08); }
  100% { transform: translate(-50%, -50%) scale(1); }
}

/* gauge section */
#gauges {
  position: relative;
  bottom: 0;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 25px;
  padding: 30px 0 60px;
  background: linear-gradient(to bottom, #002040, #000c1a);
  border-top: 3px solid #0066cc;
}
.gaugeBox {
  background: linear-gradient(to bottom, #f6f8fb, #e7ecf3);
  border-radius: 14px;
  width: 270px;
  height: 280px;
  padding: 10px;
  box-shadow: 0 0 15px rgba(0,0,0,0.25);
  color: #003366;
}
.label {
  font-size: 1.2em;
  font-weight: bold;
  margin-top: 5px;
  color: #003366;
}
.value {
  font-size: 1.2em;
  font-weight: bold;
  color: #000;
}
.mean {
  font-size: 0.9em;
  color: #444;
}
footer {
  font-size: 0.9em;
  color: #a9c9ff;
  background: #001b3a;
  padding: 10px;
}
a {
  color: #fff;
  background: #0066cc;
  padding: 10px 18px;
  border-radius: 10px;
  text-decoration: none;
  font-weight: bold;
  margin-top: 15px;
  display: inline-block;
  transition: 0.3s;
}
a:hover {
  background: #0099ff;
}
</style>
</head>

<body>
<header>üå§Ô∏è Langini Meteo Online</header>

<div id="sky">
  <div id="stars"></div>
  <div id="sun" style="display:none;"></div>
  <div id="moon" style="display:none;"></div>
</div>

<div id="gauges">
  <div class="gaugeBox">
    <div id="g1" style="height:160px"></div>
    <div class="label">Pressione (hPa)</div>
    <div class="value">Live: <span id="v1">--</span></div>
    <div class="mean">Media oraria: <span id="m1">--</span></div>
  </div>
  <div class="gaugeBox">
    <div id="g2" style="height:160px"></div>
    <div class="label">Temperatura (¬∞C)</div>
    <div class="value">Live: <span id="v2">--</span></div>
    <div class="mean">Media oraria: <span id="m2">--</span></div>
  </div>
  <div class="gaugeBox">
    <div id="g3" style="height:160px"></div>
    <div class="label">Umidit√† (%)</div>
    <div class="value">Live: <span id="v3">--</span></div>
    <div class="mean">Media oraria: <span id="m3">--</span></div>
  </div>
  <div class="gaugeBox">
    <div id="g4" style="height:160px"></div>
    <div class="label">Qualit√† Aria (MQ135)</div>
    <div class="value">Live: <span id="v4">--</span></div>
    <div class="mean">Media oraria: <span id="m4">--</span></div>
  </div>
</div>

<a href="grafici.html">üìä Vedi Grafici Dettagliati</a>

<footer>
Aggiornamento automatico ogni 30 s<br>
¬© 2025 Langini Meteo ‚Ä¢ ThingSpeak API live
</footer>

<script>
const CHANNEL_ID = 3149218;
const API_KEY = "4EGG4DXUFDU6FUGN";

// === Genera stelle random ===
function generaStelle() {
  const starsContainer = document.getElementById("stars");
  for (let i = 0; i < 70; i++) {
    const s = document.createElement("div");
    s.classList.add("star");
    s.style.left = Math.random() * 100 + "%";
    s.style.top = Math.random() * 100 + "%";
    s.style.animationDelay = (Math.random() * 4) + "s";
    s.style.opacity = Math.random();
    starsContainer.appendChild(s);
  }
}
generaStelle();

// === Sole/Luna dinamici ===
function aggiornaCielo() {
  const ora = new Date().getHours();
  const sun = document.getElementById("sun");
  const moon = document.getElementById("moon");
  const stars = document.getElementById("stars");
  const sky = document.getElementById("sky");

  if (ora >= 6 && ora < 18) {
    sun.style.display = "block";
    moon.style.display = "none";
    stars.style.display = "none";
    sky.style.background = "linear-gradient(to bottom, #00baff, #0070c0)";
  } else {
    sun.style.display = "none";
    moon.style.display = "block";
    stars.style.display = "block";
    sky.style.background = "linear-gradient(to bottom, #000820, #002850)";
  }
}
aggiornaCielo();
setInterval(aggiornaCielo, 60000);

// === Gauge ===
const g1 = new JustGage({ id:"g1", value:0, min:950, max:1050, gaugeWidthScale:0.8, counter:true, pointer:true, levelColors:["#00ccff","#00ff99","#ffcc00","#ff3300"] });
const g2 = new JustGage({ id:"g2", value:0, min:-10, max:50, gaugeWidthScale:0.8, counter:true, pointer:true, levelColors:["#3399ff","#00ccff","#ffcc00","#ff3300"] });
const g3 = new JustGage({ id:"g3", value:0, min:0, max:100, gaugeWidthScale:0.8, counter:true, pointer:true, levelColors:["#ff3300","#ffcc00","#00cc66","#0099ff"] });
const g4 = new JustGage({ id:"g4", value:0, min:0, max:500, gaugeWidthScale:0.8, counter:true, pointer:true, levelColors:["#00cc66","#ffcc00","#ff6600","#ff0000"] });

// === Dati da ThingSpeak ===
async function aggiorna() {
  try {
    const url = `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${API_KEY}&results=60`;
    const res = await fetch(url);
    const data = await res.json();
    if (!data.feeds || data.feeds.length === 0) return;

    const feeds = data.feeds.map(f => ({
      f1: parseFloat(f.field1),
      f2: parseFloat(f.field2),
      f3: parseFloat(f.field3),
      f4: parseFloat(f.field4)
    }));

    const ultimo = feeds[feeds.length - 1];
    const media = arr => (arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(1);
    const medie = {
      m1: media(feeds.map(f=>f.f1)),
      m2: media(feeds.map(f=>f.f2)),
      m3: media(feeds.map(f=>f.f3)),
      m4: media(feeds.map(f=>f.f4))
    };

    g1.refresh(ultimo.f1); g2.refresh(ultimo.f2); g3.refresh(ultimo.f3); g4.refresh(ultimo.f4);
    document.getElementById("v1").textContent = ultimo.f1.toFixed(1);
    document.getElementById("v2").textContent = ultimo.f2.toFixed(1);
    document.getElementById("v3").textContent = ultimo.f3.toFixed(1);
    document.getElementById("v4").textContent = ultimo.f4.toFixed(1);
    document.getElementById("m1").textContent = medie.m1;
    document.getElementById("m2").textContent = medie.m2;
    document.getElementById("m3").textContent = medie.m3;
    document.getElementById("m4").textContent = medie.m4;
  } catch (e) {
    console.error("Errore durante aggiornamento:", e);
  }
}
aggiorna();
setInterval(aggiorna, 30000);
</script>
</body>
</html>
