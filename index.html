<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Langini Meteo ‚Äì Dashboard V5.3</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/raphael@2.3.0/raphael.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/justgage@1.5.0/justgage.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>

<style>
body{margin:0;font-family:"Poppins",sans-serif;color:white;text-align:center;overflow-x:hidden;
transition:background 2s;background:linear-gradient(to bottom,#001b3a 0%,#004a8d 40%,#0066b2 100%);}
header{background:rgba(0,0,30,0.7);color:#fff;padding:16px 0 4px;font-size:1.7em;font-weight:600;
box-shadow:0 2px 10px rgba(0,0,0,0.25);}
#logo{font-size:1.05em;font-weight:400;color:#a9c9ff;}
#statusBar{background:rgba(0,0,0,0.15);font-size:0.93em;color:#a9c9ff;padding:6px;}
#sky{position:relative;height:46vh;overflow:hidden;border-bottom:4px solid #048;}
#stars{position:absolute;inset:0;opacity:0;z-index:2;}
.star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:twinkle 4s infinite;}
@keyframes twinkle{0%,100%{opacity:0.2}50%{opacity:1}}
#sun,#moon{position:absolute;top:53%;left:50%;width:110px;height:110px;border-radius:50%;
transform:translate(-50%,-50%);transition:left 1.5s,top 1.5s,opacity 2s;z-index:3;opacity:0;}
#sun{background:radial-gradient(circle,#fff600 20%,#ffcc00 70%,#ffaa00 100%);box-shadow:0 0 40px 10px #ffcc00;}
#moon{background:radial-gradient(circle at 31% 32%,#f0f0f0 40%,#bdbdbd 100%);box-shadow:0 0 25px 5px #ccc;}
.cloud{position:absolute;background:rgba(255,255,255,0.8);border-radius:50%;
box-shadow:-30px 10px 30px rgba(255,255,255,0.7),40px 15px 40px rgba(255,255,255,0.6),
70px 20px 60px rgba(255,255,255,0.5);animation:fluttuare 6s ease-in-out infinite alternate;z-index:1;}
@keyframes fluttuare{from{transform:translateY(0)}to{transform:translateY(8px)}}
body.alba{background:linear-gradient(to bottom,#ffb347 0%,#ffd194 40%,#87ceeb 100%)!important;}
body.tramonto{background:linear-gradient(to bottom,#f46b45 0%,#eea849 50%,#002850 100%)!important;}

/* === BANNER ALBA/TRAMONTO === */
#phaseMsg{
  position:absolute;top:14%;left:50%;transform:translateX(-50%);
  font-size:1.9em;font-weight:700;padding:10px 22px;border-radius:30px;
  opacity:0;z-index:5;text-transform:uppercase;letter-spacing:1px;
  background:rgba(0,0,0,0.3);color:transparent;-webkit-background-clip:text;
  text-shadow:0 0 18px rgba(255,255,255,0.4);
  box-shadow:0 0 15px rgba(255,255,255,0.25);border:2px solid transparent;
}
#phaseMsg.albaColor{
  background-image:linear-gradient(90deg,#ffcc00,#ff6600,#ffaa00);
  border-color:#ffb347;
  animation:fadeBanner 20s ease forwards, glowAlba 3s infinite alternate;
}
#phaseMsg.tramontoColor{
  background-image:linear-gradient(90deg,#ff6699,#ff3300,#cc0033);
  border-color:#ff6688;
  animation:fadeBanner 20s ease forwards, glowTramonto 3s infinite alternate;
}
@keyframes fadeBanner{0%{opacity:0;transform:translate(-50%,-20px);}20%{opacity:1;transform:translate(-50%,0);}
80%{opacity:1;}100%{opacity:0;transform:translate(-50%,10px);}}
@keyframes glowAlba{from{box-shadow:0 0 20px 6px rgba(255,204,51,0.6);}
to{box-shadow:0 0 40px 12px rgba(255,153,0,0.8);}}
@keyframes glowTramonto{from{box-shadow:0 0 20px 6px rgba(255,102,153,0.6);}
to{box-shadow:0 0 40px 12px rgba(255,0,51,0.8);}}

/* === MQ135 ALERT + TESTO === */
.alertGood{background:linear-gradient(to bottom,#d4fdd4,#aef1ae)!important;}
.alertBad{background:linear-gradient(to bottom,#fff3d4,#ffd9b3)!important;animation:blinkBad 1.5s infinite alternate;}
@keyframes blinkBad{from{box-shadow:0 0 18px 4px rgba(255,180,0,0.5);}to{box-shadow:0 0 28px 6px rgba(255,90,0,0.8);}}
#qualitaTesto{
  position:absolute;bottom:12px;left:50%;transform:translateX(-50%);
  font-size:1.05em;font-weight:600;color:#003366;text-shadow:0 0 6px rgba(255,255,255,0.6);
  transition:all 0.6s ease;
}

/* === ALTRO === */
#scroller{position:absolute;top:20%;left:-100%;font-size:1.3em;font-weight:600;white-space:nowrap;
opacity:0;z-index:4;color:#000;text-shadow:0 0 8px rgba(255,255,255,0.5);}
@keyframes scrollText{from{left:-40%;opacity:0}10%{opacity:1}90%{opacity:1}to{left:120%;opacity:0}}
#sunMoonTimes{font-size:1em;color:#000;background:rgba(255,255,255,0.6);display:inline-block;
padding:4px 10px;border-radius:12px;margin:8px auto;box-shadow:0 0 6px rgba(0,0,0,0.25);
font-weight:600;transition:all 1s ease;}
#gauges{display:flex;flex-wrap:wrap;justify-content:center;gap:26px;
padding:30px 0 40px;background:linear-gradient(to bottom,#002850,#00142c);border-top:3px solid #004b8d;}
.gaugeBox{background:linear-gradient(to bottom,#f8fbff,#e6edf5);border-radius:18px;width:260px;height:270px;
padding:10px;color:#003366;box-shadow:0 0 14px rgba(0,0,0,0.14);position:relative;}
.gaugeBox img{position:absolute;top:10px;right:10px;width:38px;opacity:0.84;}
.label{font-size:1.17em;font-weight:600;margin-top:7px;}
.value{font-size:1.23em;font-weight:bold;color:#000;margin-top:4px;}
.mean{font-size:0.9em;color:#444;margin-top:2px;}
footer{font-size:0.93em;color:#a9c9ff;background:#001b3a;padding:10px;}
a{color:#fff;background:#0078ff;padding:11px 18px;border-radius:8px;text-decoration:none;font-weight:600;
display:inline-block;margin-top:14px;transition:0.3s;}a:hover{background:#00aaff;}
</style>
</head>

<body>
<header>üå§Ô∏è Langini Meteo ‚Äì Dashboard V5.3<br><div id="logo">by Langini D.</div></header>
<div id="statusBar">Caricamento dati...</div>

<div id="sky"><div id="stars"></div><div id="sun"></div><div id="moon"></div></div>
<div id="phaseMsg"></div>
<div id="scroller">Grafica in aggiornamento...</div>
<div id="sunMoonTimes">‚òÄÔ∏è Alba: --:-- ‚Ä¢ üåá Tramonto: --:--</div>

<div id="gauges">
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/barometer.png"><div id="g1" style="height:150px"></div><div class="label">Pressione (hPa)</div><div class="value">Live: <span id="v1">--</span></div><div class="mean">Media oraria: <span id="m1">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/temperature.png"><div id="g2" style="height:150px"></div><div class="label">Temperatura (¬∞C)</div><div class="value">Live: <span id="v2">--</span></div><div class="mean">Media oraria: <span id="m2">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/hygrometer.png"><div id="g3" style="height:150px"></div><div class="label">Umidit√† (%)</div><div class="value">Live: <span id="v3">--</span></div><div class="mean">Media oraria: <span id="m3">--</span></div></div>
  <div class="gaugeBox"><img src="https://img.icons8.com/fluency/48/smelling.png"><div id="g4" style="height:150px"></div><div class="label">Qualit√† Aria (MQ135)</div><div class="value">Live: <span id="v4">--</span></div><div class="mean">Media oraria: <span id="m4">--</span></div><div id="qualitaTesto">--</div></div>
</div>

<a href="grafici.html">üìä Vedi Grafici Dettagliati</a>
<footer>¬© 2025 Langini Meteo ‚Ä¢ Aggiornamento ogni 30 s</footer>

<audio id="campana" preload="auto"><source src="https://cdn.pixabay.com/audio/2022/03/15/audio_6f4b8e2be3.mp3" type="audio/mpeg"></audio>
<audio id="suonoAlba" preload="auto"><source src="https://cdn.pixabay.com/download/audio/2023/03/14/audio_263b4f5168.mp3?filename=birds-chirping-ambient-141717.mp3" type="audio/mpeg"></audio>
<audio id="suonoTramonto" preload="auto"><source src="https://cdn.pixabay.com/download/audio/2021/08/09/audio_310d5f7f29.mp3?filename=crickets-ambient-night-6787.mp3" type="audio/mpeg"></audio>

<script>
const LAT=45.77,LON=8.88,CHANNEL_ID=3149218;

// Stelle/Nuvole
(()=>{const s=document.getElementById('stars');
for(let i=0;i<40;i++){let e=document.createElement('div');e.className='star';
e.style.left=Math.random()*100+'%';e.style.top=Math.random()*100+'%';
e.style.animationDelay=Math.random()*3+'s';s.appendChild(e);}})();

// Cielo dinamico + eventi sonori
function mostraEvento(fase){const msg=document.getElementById("phaseMsg");
const a1=document.getElementById("suonoAlba"),a2=document.getElementById("suonoTramonto");
[a1,a2].forEach(a=>{a.pause();a.currentTime=0;});
if(fase==="alba"){msg.textContent="üåÖ ALBA IN CORSO";msg.className="albaColor";
a1.volume=0;a1.play().catch(()=>{});let v=0;const fi=setInterval(()=>{v+=0.05;if(v>=0.7)clearInterval(fi);a1.volume=Math.min(v,0.7);},300);
setTimeout(()=>{const fo=setInterval(()=>{v-=0.05;if(v<=0){clearInterval(fo);a1.pause();}a1.volume=Math.max(v,0);},300);},15000);}
if(fase==="tramonto"){msg.textContent="üåá TRAMONTO IN CORSO";msg.className="tramontoColor";
a2.volume=0;a2.play().catch(()=>{});let v=0;const fi=setInterval(()=>{v+=0.05;if(v>=0.7)clearInterval(fi);a2.volume=Math.min(v,0.7);},300);
setTimeout(()=>{const fo=setInterval(()=>{v-=0.05;if(v<=0){clearInterval(fo);a2.pause();}a2.volume=Math.max(v,0);},300);},15000);}}

// Gestione cielo
function minutiToOra(m){const h=Math.floor(m/60),min=Math.floor(m%60);return`${String(h).padStart(2,"0")}:${String(min).padStart(2,"0")}`;}
function aggiornaCielo(){const now=new Date(),t=SunCalc.getTimes(now,LAT,LON);
const alba=t.sunrise.getHours()*60+t.sunrise.getMinutes();
const tram=t.sunset.getHours()*60+t.sunset.getMinutes();
const curr=now.getHours()*60+now.getMinutes();
const info=document.getElementById("sunMoonTimes");
const sun=document.getElementById("sun"),moon=document.getElementById("moon"),stars=document.getElementById("stars"),msg=document.getElementById("phaseMsg");
info.innerHTML=`‚òÄÔ∏è Alba: ${minutiToOra(alba)} ‚Ä¢ üåá Tramonto: ${minutiToOra(tram)}`;
const diffA=Math.abs(curr-alba),diffT=Math.abs(curr-tram),isDay=curr>=alba&&curr<tram;
if(isDay){stars.style.opacity=0;sun.style.opacity=1;moon.style.opacity=0;
if(diffA<30){document.body.className="alba";mostraEvento("alba");}
else if(diffT<30){document.body.className="tramonto";mostraEvento("tramonto");}
else{document.body.className="";msg.className="";msg.style.opacity=0;}
const p=(curr-alba)/(tram-alba);sun.style.left=5+p*90+"%";sun.style.top=53-17*Math.sin(p*Math.PI)+"%";}
else{stars.style.opacity=0.9;moon.style.opacity=1;sun.style.opacity=0;
if(diffT<30){document.body.className="tramonto";mostraEvento("tramonto");}
else if(diffA<30){document.body.className="alba";mostraEvento("alba");}
else{document.body.className="";msg.className="";msg.style.opacity=0;}
const tot=(24*60-tram)+alba;const pass=curr>=tram?(curr-tram):(curr+24*60-tram);
const p=pass/tot;moon.style.left=95-p*90+"%";moon.style.top=53-12*Math.sin(p*Math.PI)+"%";}}
setInterval(aggiornaCielo,60000);window.onload=aggiornaCielo;

// Rotazione sole/luna
let angle=0;setInterval(()=>{angle+=0.04;
const s=document.getElementById("sun"),m=document.getElementById("moon");
(s.style.opacity>0.5?s:m).style.transform=`translate(-50%,-50%) rotate(${angle}rad)`;},120);

// Gauges
const g1=new JustGage({id:"g1",value:0,min:950,max:1050,pointer:true});
const g2=new JustGage({id:"g2",value:0,min:-10,max:50,pointer:true});
const g3=new JustGage({id:"g3",value:0,min:0,max:100,pointer:true});
const g4=new JustGage({id:"g4",value:0,min:0,max:500,pointer:true});

async function aggiorna(){
try{
const r=await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=60`);
const d=await r.json();if(!d.feeds||!d.feeds.length){document.getElementById("statusBar").textContent="‚ö†Ô∏è Nessun dato disponibile";return;}
const f=d.feeds.map(e=>({f1:+e.field1,f2:+e.field2,f3:+e.field3,f4:+e.field4})),u=f.at(-1);
const avg=a=>{const v=a.filter(x=>!isNaN(x));return v.length?(v.reduce((a,b)=>a+b,0)/v.length).toFixed(1):"--";};
g1.refresh(u.f1);g2.refresh(u.f2);g3.refresh(u.f3);g4.refresh(u.f4);
["v1","v2","v3","v4"].forEach((id,i)=>document.getElementById(id).textContent=isNaN(u[`f${i+1}`])?"--":u[`f${i+1}`].toFixed(1));
["m1","m2","m3","m4"].forEach((id,i)=>document.getElementById(id).textContent=avg(f.map(x=>x[`f${i+1}`])));

// --- MQ135 COLORE + TESTO + LAMPEGGIO ---
const box4=document.querySelectorAll('.gaugeBox')[3];
const testo=document.getElementById('qualitaTesto');
if(isNaN(u.f4))return;
const aqi=u.f4;let colore='#00e400',desc='üåø Aria eccellente';
if(aqi<=50){colore='#00e400';desc='üåø Aria eccellente';}
else if(aqi<=100){colore='#9cff00';desc='üôÇ Aria buona';}
else if(aqi<=150){colore='#ffde33';desc='‚ö†Ô∏è Qualit√† moderata';}
else if(aqi<=200){colore='#ff9933';desc='üò∑ Aria scadente';}
else if(aqi<=300){colore='#cc0033';desc='‚ò†Ô∏è Aria molto scarsa';}
else{colore='#660099';desc='üíÄ Aria pericolosa';}
g4.config.levelColors=[colore];g4.refresh(aqi);
testo.textContent=desc;testo.style.color=colore;
if(aqi<=150){box4.classList.remove('alertGood');box4.classList.add('alertBad');}
else{box4.classList.remove('alertBad');box4.classList.add('alertGood');}

document.getElementById("statusBar").textContent=`‚úÖ Aggiornato alle ${new Date().toLocaleTimeString("it-IT")}`;
}catch(e){document.getElementById("statusBar").textContent="‚ö†Ô∏è Errore connessione";console.error(e);}
}
aggiorna();setInterval(aggiorna,30000);
</script>
</body>
</html>
